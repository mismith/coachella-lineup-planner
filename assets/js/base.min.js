angular.module("firebaseHelper",["firebase"]).service("$firebaseHelper",["$firebase","$q",function(e,r){var t=this,n="",a={};return t.namespace=function(e){return void 0!==e&&(n=e),n},t.$ref=function(){var e=Array.prototype.slice.call(arguments),r="Ref/"+e.join("/");if(a[r])return a[r];var t=new Firebase("https://"+n+".firebaseio.com/"+(e.join("/")||""));return a[r]=t,t},t.$inst=function(){if(1==arguments.length&&arguments[0]instanceof Firebase){var r=arguments[0],n="Inst"+r.path;if(a[n])return a[n];var o=e(r);return a[n]=o,o}var i=Array.prototype.slice.call(arguments),n="Inst/"+i.join("/");if(a[n])return a[n];var o=e(t.$ref.apply(this,i));return a[n]=o,o},t.$get=function(){var e=Array.prototype.slice.call(arguments),r="Object";e[e.length-1]===!0&&(r="Array",e.pop());var n=r+"/"+e.join("/");if(a[n])return a[n];var o=t.$inst.apply(this,e)["$as"+r]();return a[n]=o,o},t.$load=function(){return t.$get.apply(this,arguments).$loaded()},t.$child=function(){var e=Array.prototype.slice.call(arguments),r=e.shift();return angular.isFunction(r.$inst)&&(r=r.$inst()),angular.isFunction(r.$ref)&&(r=r.$ref()),angular.isFunction(r.child)?t.$inst(r.child(e.join("/"))):r},t.$populate=function(e,n,a){var o=[],i=t.$ref(e);return i.once("value",function(e){angular.isObject(e.val())||angular.isFunction(a)&&a()}),i.on("child_added",function(e){var i=t.$get(n,e.name());i.$loaded().then(function(){var e=[];angular.isFunction(a)&&e.push(a(i)),r.all(e).then(function(){o.push(i)})})}),i.on("child_removed",function(e){o.splice($rootScope.childById(o,e.name(),void 0,!0),1)}),o},t.$intersect=function(r,n,a,o){if(!Firebase.util)throw new Error("$firebaseHelper.$intersect requires Firebase.util external library. See: https://github.com/firebase/firebase-util");var i={ref:t.$ref(r)},u={ref:t.$ref(n)};return a&&(i.keyMap=a),o&&(u.keyMap=o),e(Firebase.util.intersection(i,u)).$asArray()},t}]),angular.module("coachella",["ui.router","ui.bootstrap","firebase","firebaseHelper"]).config(["$locationProvider","$urlRouterProvider","$stateProvider",function(e,r,t){r.when("","/"),r.when("/","/2015"),t.state("year",{url:"/:year",templateUrl:"views/year.html"}).state("year:edit",{url:"/:year/edit",templateUrl:"views/edit.html",resolve:{isAdmin:["$rootScope","$q",function(e,r){var t=r.defer();return e.$auth.$getCurrentUser().then(function(e){e&&"facebook:120605287"==e.uid?t.resolve():t.reject()}),t.promise}]}})}]).controller("AppCtrl",["$rootScope","$state","$firebase","$firebaseHelper","$firebaseSimpleLogin",function(e,r,t,n,a){n.namespace("coachellalp"),e.$state=r,e.$auth=a(n.$ref()),e.$on("$firebaseSimpleLogin:login",function(e,r){n.$ref("users/"+r.uid).set(r)}),e.$on("$stateChangeSuccess",function(){e.year=e.$state.params.year,e.bands=n.$get("bands/"+e.year,!0),e.users=n.$get("users")})}]).controller("BandsCtrl",["$scope","$firebaseHelper",function(e,r){e.vote=function(t,n){var a=function(){var a=r.$child(e.bands,t+"/votes/"+e.$auth.user.uid+"/vote");a.$asObject().$loaded().then(function(e){e.$value==n?a.$remove():a.$set(n)})};e.$auth.user?a():e.$auth.$login("facebook").then(function(){a()},function(e){console.error(e)})},e.mustsee=function(t){var n=function(){var n=r.$child(e.bands,t+"/mustsee/"+e.$auth.user.uid+"/mustsee");n.$asObject().$loaded().then(function(e){e.$value?n.$set(!1):n.$set(!0)})};e.$auth.user?n():e.$auth.$login("facebook").then(function(){n()},function(e){console.error(e)})},e.orderBy=void 0,e.orderByStr=void 0,e.orderByDir=void 0,e.toggleOrder=function(r){switch(e.orderByStr==r&&(e.orderByDir=!e.orderByDir),e.orderByStr=r,r){case"mustsee":r=function(e){var r=0;if(e.mustsee)for(var t in e.mustsee)r++;return r};break;case"votes":r=function(e){var r=0;if(e.votes)for(var t in e.votes)r++;return r};break;case"vote":r=function(r){var t=-2;return r.votes&&angular.forEach(r.votes,function(r,n){n==e.$auth.user.uid&&(t=r.vote)}),t};break;case void 0:return e.orderBy=["day","$id"],e.orderByDir=!1,void 0;case"day":return e.orderBy=["day","name"],void 0}e.orderBy=r},e.toggleOrder(),e.filterDay=0}]).controller("BandCtrl",["$scope",function(e){e.init=function(r){e.data=r},e.$watch("data.votes",function(r){var t=0;return angular.forEach(r,function(e){t+=e.vote}),e.data=e.data||{},e.data.score=t}),e.add=function(r){r&&r.name&&r.day&&e.bands.$add(r).then(function(){r.name="",e.added=!0})},e.remove=function(r,t){r&&r.$id&&(t||confirm("Are you sure you want to permanently delete this?"))&&e.bands.$remove(r)}}]).directive("ngAutofocus",function(){return{restrict:"A",link:function(e,r,t){e.$watch(function(){return e.$eval(t.ngAutofocus)},function(e){e&&r[0].focus()})}}});